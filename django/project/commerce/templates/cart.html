{% extends "base.html" %}
{% load static %}

{% block title %}
My Cart
{% endblock title %}

{% block content %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://kit.fontawesome.com/a2e0e6ad0f.js" crossorigin="anonymous"></script>

<style>
  .cart-item {
    border-radius: .5rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    transition: 0.2s;
  }
  .cart-item:hover {
    transform: translateY(-3px);
  }
  .cart-img {
    height: 100px;
    width: 100px;
    object-fit: cover;
    border-radius: .5rem;
  }
  .price-original {
    text-decoration: line-through;
    color: #6c757d;
  }
  .price-discounted {
    font-weight: 600;
    color: #0d6efd;
  }
  .quantity-input {
    width: 60px;
    text-align: center;
  }
  .qty-btn {
    border: none;
    background: transparent;
    color: #0d6efd;
    font-size: 1.2rem;
    padding: 0 8px;
  }
  .qty-btn:hover {
    color: #0a58ca;
  }
</style>

<div class="container py-5">
  <h2 class="fw-bold mb-4">üõí My Cart</h2>

  {% if carts %}
    {% for cart in carts %}
      <div class="cart-item bg-white p-3 mb-3 d-flex align-items-center justify-content-between">
        <!-- Product Info -->
        <div class="d-flex align-items-center gap-3">
          <img src="{{ cart.product.image.url }}" alt="{{ cart.product.name }}" class="cart-img">
          <div>
            <h5 class="mb-1">{{ cart.product.name }}</h5>

            <!-- Quantity Section -->
            <div class="d-flex align-items-center mt-2">
              <form action="{% url 'update_cart' cart.id %}" method="POST" class="d-flex align-items-center m-0">
                {% csrf_token %}
                <button type="button" class="qty-btn" onclick="changeQty(this, -1)">‚àí</button>
                <input type="number" name="quantity" value="{{ cart.quantity }}" min="1" class="form-control form-control-sm quantity-input" readonly>
                <button type="button" class="qty-btn" onclick="changeQty(this, 1)">+</button>
                <button type="submit" class="btn btn-sm btn-outline-primary ms-2">Update</button>
              </form>
            </div>

            <!-- Price Section -->
            <div class="d-flex align-items-center gap-2 mt-2">
              {% if cart.product.discounted_price < cart.product.original_price %}
                <span class="price-discounted">‚Çπ{{ cart.product.discounted_price }}</span>
                <span class="price-original">‚Çπ{{ cart.product.original_price }}</span>
              {% else %}
                <span class="price-discounted">‚Çπ{{ cart.product.original_price }}</span>
              {% endif %}
            </div>
          </div>
        </div>

        <!-- Remove Button -->
        <div>
          <form action="{% url 'remove_item' cart.id %}" method="POST" class="m-0">
            {% csrf_token %}
            <button type="submit" class="btn btn-outline-danger btn-sm">Remove</button>
          </form>
        </div>
      </div>
    {% endfor %}

    <div class="text-end mt-4">
      <a href="#" class="btn btn-success px-4 py-2">Proceed to Checkout (‚Çπ{{ total_price }}) ‚Üí</a>
    </div>

  {% else %}
    <div class="text-center py-5">
      <h5 class="text-muted">üõçÔ∏è Your cart is empty!</h5>
      <a href="{% url 'shop' %}" class="btn btn-primary mt-3">Continue Shopping</a>
    </div>
  {% endif %}
</div>

<script>
  // JS to handle + and - buttons
  function changeQty(button, delta) {
    const input = button.parentNode.querySelector('input[type=number]');
    let value = parseInt(input.value);
    if (isNaN(value)) value = 1;
    value = Math.max(1, value + delta); // prevent going below 1
    input.value = value;
  }
</script>

{% endblock content %}
